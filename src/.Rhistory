pf_ret = compustat_sel %>%
group_by(yw, pf_number) %>%
summarize(ret = sum(eretw*me, na.rm = TRUE)/sum(me, na.rm = TRUE), Mkt.RF = mean(Mkt.RF), SMB = mean(SMB), HML = mean(HML), RF = mean(RF))
kkhml_ret = compustat_sel %>%
drop_na(topic_kk) %>%
ungroup() %>%
group_by(yw, ntile_topic_kk) %>%
summarize(ret = sum(eretw*me, na.rm = TRUE)/sum(me, na.rm = TRUE)) %>%
pivot_wider(names_from = ntile_topic_kk, names_prefix = "kk", values_from = ret) %>%
transmute(yw, kkhml = kk4-kk1)
eret_we = pf_ret %>%
inner_join(kkhml_ret, by = c("yw")) %>%
rename(eretw = ret)  %>%
drop_na() %>%
ungroup()
formula3ff <- eretw ~ kkhml + HML + SMB + Mkt.RF
first_stage1 = eret_we %>%
ungroup() %>%
nest_by(pf_number) %>%
mutate(mod = list(lm(formula3ff <- eretw ~ kkhml + HML + SMB + Mkt.RF, data = data))) %>%
summarize(eretw = mean(data$eretw), t = length(data$eretw), tidy(mod))
get_sigmae = first_stage1 %>%
mutate(sigmae = t*std.error^2) %>%
filter(term == "(Intercept)") %>%
select(pf_number, sigmae) %>%
drop_na()
first_stage2 = first_stage1 %>%
select(-std.error, -statistic, -p.value) %>%
pivot_wider(names_from = term, values_from = estimate) %>%
full_join(get_sigmae, by = c("pf_number")) %>%
drop_na()
second_stage_ols = lm(formula3ff <- eretw ~ kkhml + HML + SMB + Mkt.RF, data = first_stage2)
second_stage_wls = lm(formula3ff, data = first_stage2, weights = first_stage2$sigmae)
summary(second_stage_ols)
summary(second_stage_wls)
latex_table <- stargazer(second_stage_ols, second_stage_wls, title = "Regression Summary", align = TRUE, out = paste0(figfolder, "summary_table.tex"))
we_ret_bybin = compustat_sel %>%
mutate(ntile_topic_kk = factor(ntile_topic_kk)) %>%
group_by(yw, ntile_topic_kk) %>%
summarize(eret = sum(eretw*me, na.rm = TRUE)/sum(me, na.rm = TRUE), sderet = sd(eretw, na.rm = TRUE)) %>%
ungroup() %>%
group_by(ntile_topic_kk) %>%
mutate(eret_accum = cumsum(eret)) %>%
yw2day()
qt_ret_bygroup = we_ret_bybin %>%
group_by(ntile_topic_kk) %>%
mutate(eret3ma = rollmean(eret, k=13, fill=NA, align='right'))
ggplot(we_ret_bybin, aes(x = yw, y = eret, col = ntile_topic_kk)) +
geom_line() +
labs(x = "Year-month", y = "Asset-weighted weekly returns")
ggsave(paste0(figfolder, "awwr.jpg"), plot = last_plot(), dpi = 300)
ggplot(qt_ret_bygroup, aes(x = yw, y = eret3ma, col = ntile_topic_kk)) + geom_line()  +
labs(x = "Year-month", y = "Asset-weighted weekly returns, 3MA")
ggsave(paste0(figfolder, "awwr3ma.jpg"), plot = last_plot(), dpi = 300)
ggplot(we_ret_bybin , aes(x = yw, y = eret_accum, col = ntile_topic_kk)) +
geom_line() +
labs(x = "Year-month", y = "Asset-weighted accumulated weekly returns")
ggsave(paste0(figfolder, "awawr.jpg"), plot = last_plot(), dpi = 300)
ggplot(we_ret_bybin %>% filter(ntile_topic_kk %in% c(1,4)) , aes(x = yw, y = sderet, col = ntile_topic_kk)) + geom_line() + labs(x = "Year-month", y = "(Non-asset-weighted) weekly standard deviation of returns")
ggsave(paste0(figfolder, "wsdr.jpg"), plot = last_plot(), dpi = 300)
we_ret_bygroup = compustat_sel %>%
mutate(max_topic = factor(max_topic)) %>%
group_by(yw, max_topic) %>%
summarize(eret = sum(eretw*me, na.rm = TRUE)/sum(me, na.rm = TRUE), sderet = sd(eretw, na.rm = TRUE)) %>%
ungroup() %>%
group_by(max_topic) %>%
mutate(eret_accum = cumsum(eret)) %>%
ungroup() %>%
yw2day()
qt_ret_bygroup = we_ret_bygroup %>%
group_by(max_topic) %>%
mutate(eret3ma = rollmean(eret, k=13, fill=NA, align='right'))
ggplot(we_ret_bygroup, aes(x = yw, y = eret, col = max_topic)) +
geom_line() +
labs(x = "Year-month", y = "Asset-weighted weekly returns")
ggsave(paste0(figfolder, "awwr_byg.jpg"), plot = last_plot(), dpi = 300)
ggplot(qt_ret_bygroup, aes(x = yw, y = eret3ma, col = max_topic)) + geom_line()  +
labs(x = "Year-month", y = "Asset-weighted weekly returns, 3MA")
ggsave(paste0(figfolder, "awwr3ma_byg.jpg"), plot = last_plot(), dpi = 300)
ggplot(we_ret_bygroup, aes(x = yw, y = eret_accum, col = max_topic)) +
geom_line() +
labs(x = "Year-month", y = "Asset-weighted accumulated weekly returns")
ggsave(paste0(figfolder, "awawr_byg.jpg"), plot = last_plot(), dpi = 300)
ggplot(we_ret_bygroup , aes(x = yw, y = sderet, col = max_topic)) +
geom_line() +
labs(x = "Year-month", y = "(Non-asset-weighted) weekly standard deviation of returns")
ggsave(paste0(figfolder, "wsdr_byg.jpg"), plot = last_plot(), dpi = 300)
source("~/Documents/PhD (local)/Research/Github/KnowledgeKRisk_10Ks/src/st4b_APanalysis_daily.R")
source("~/Documents/PhD (local)/Research/Github/KnowledgeKRisk_10Ks/src/st4b_APanalysis_daily.R")
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_p2005sampled_sh.Rdata")
stox = stoxda_p2005sampled_sh %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y" = "year")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
View(cequity_mapper)
View(topic_map)
stox = stoxda_p2005sampled_sh %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stox %>%
group_by(ym, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
mutate(ym = ym(ym)) %>%
drop_na(RET)   %>%
group_by(ym, max_topic) %>%
summarize(moment = kurtosis(RET)) %>%
ungroup() %>%
rename(group = max_topic)%>%
filter(group - floor(group) == 0) %>%
mutate(ym = factor(ym)) %>%
drop_na(group)
library(moments)
stoxda_orig = stoxda_p2005sampled_sh
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
View(stoxda)
stox_by_kkd = stoxda %>%
group_by(ym, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
mutate(ym = ym(ym)) %>%
drop_na(RET)   %>%
group_by(ym, max_topic) %>%
summarize(moment = kurtosis(RET)) %>%
ungroup() %>%
rename(group = max_topic)%>%
filter(group - floor(group) == 0) %>%
mutate(ym = factor(ym)) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, ym) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = ym, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
stox_by_kkd = stoxda %>%
group_by(ym, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
mutate(ym = ym(ym)) %>%
drop_na(RET)   %>%
group_by(y, max_topic) %>%
summarize(moment = kurtosis(RET)) %>%
ungroup() %>%
rename(group = max_topic)%>%
filter(group - floor(group) == 0) %>%
mutate(ym = factor(ym)) %>%
drop_na(group)
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic))
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
mutate(ym = ym(ym))
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
drop_na(RET)
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
drop_na(RET) %>%
group_by(y, max_topic)
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
drop_na(RET) %>%
group_by(y, max_topic) %>%
summarize(moment = kurtosis(RET))
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
drop_na(RET) %>%
group_by(y, max_topic) %>%
summarize(moment = kurtosis(RET)) %>%
ungroup() %>%
rename(group = max_topic)%>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
stox_by_kkd = stoxda %>%
group_by(y, PERMNO)
stox_by_kkd = stoxda %>%
group_by(y, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET)) %>%
ungroup()
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(date, PERMNO) %>%
summarize(RET = mean(RET), max_topic = mean(max_topic))
View(stox_by_kkd)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), max_topic = mean(max_topic)) %>%
ungroup() %>%
rename(group = max_topic) %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
View(topic_map)
View(topic_map_orig)
View(topic_map)
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
View(topic_map)
topic_map = topic_map %>%
group_by(year) %>%
mutate(ntile_topic_0 = ntile(topic_0, 4))
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(ntile_topic_0)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(ntile_topic_0)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
topic_map = topic_map %>%
group_by(year) %>%
mutate(ntile_topic_0 = ntile(topic_0, 5))
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(ntile_topic_0)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
topic_map = topic_map %>%
group_by(year) %>%
mutate(ntile_topic_0 = ntile(topic_0, 4))
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(maxtopic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_post2005veryshort.Rdata")
head(stoxda_p2005sampled_sh)
stoxda_orig = stoxda_post2005veryshort
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_post2005veryshort.Rdata")
View(stoxda_p2005sampled_sh)
View(stoxda_p2005sampled_sh)
View(stoxwe_post2005short)
View(stoxwe_post2005short)
delete(stoxwe_post2005short)
remove(stoxwe_post2005short)
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_post2005veryshort.Rdata")
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_post2005veryshort.Rdata")
remove(stoxwe_post2005short)
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxwe_post2005short.Rdata")
View(stoxwe_post2005short)
load("/Users/pedrovallocci/Documents/PhD (local)/Research/By Topic/Measuring knowledge capital risk/input/stoxda_post2005veryshort.Rdata")
stoxda_orig = stoxwe_post2005short
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
mutate(ym = y*100 + month(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
ggsave(paste0(figfolder, "kurtosis_by_maxtopic.jpg"), plot = last_plot(), dpi = 300)
topic_map = topic_map %>%
group_by(year) %>%
mutate(ntile_topic_0 = ntile(topic_0, 4))
stoxda = stoxda_orig %>%
mutate(date = ymd(date)) %>%
mutate(y = year(date)) %>%
left_join(cequity_mapper, by = c("PERMNO" = "PERMNO", "y")) %>%
filter(crit_ALL == 1) %>%
left_join(topic_map, by = c("PERMNO" = "LPERMNO", "y" = "year"))
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(max_topic)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kkd = stoxda %>%
drop_na(RET) %>%
group_by(y, PERMNO) %>%
summarize(moment = kurtosis(RET), group = mean(ntile_topic_0)) %>%
ungroup() %>%
filter(group - floor(group) == 0) %>%
drop_na(group)
stox_by_kk2 = stox_by_kkd %>%
group_by(group, y) %>%
summarize(moment = mean(moment, na.rm = TRUE)) %>%
ungroup() %>%
mutate(group = factor(group))
ggplot(stox_by_kk2, aes(x = y, y = moment, group = group, color = group)) +
geom_line() +
labs(x = "y", y = "moment") +
scale_color_discrete(name = "group") +
theme_minimal()
